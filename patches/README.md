## smali patches

Certain things are too difficult to patch via hooking, and this has become necessary in order to continue backporting features from RNA.

These patches are organized in a way that

1. Each patch can only be applied to ONE class
2. Each patch is based on the output of configured [`google/smali@3.0.7`](https://github.com/google/smali). **APKTOOL WILL NOT WORK.**
3. Each patch's path is the the qualified class name + `.patch`, relative from `src/`
    - For example, patching the class `com.discord.BuildConfig` would have a patch at `src/com/discord/BuildConfig.patch`. The before/after file name
      header in the patch <ins>does not matter</ins>.
4. Each patch is a unified diff generated by the `diff` util (not git).

These patches are then bundled and published to be downloaded by the [Aliucord Manager](https://github.com/Aliucord/Manager) which applies them before
installing Aliucord.

## Tooling

1. Ensure you have diffutils (`diff`/`patch`) installed (on windows: [via chocolatey](https://community.chocolatey.org/packages/diffutils))
2. Run the `:patches:disassembleWithPatches` task in order to disassemble and apply any existing patches in `./src`
3. Perform any additional modifications necessary to the `./smali` directory
4. Run the `:patches:test` task in order to check that the smali still successfully reassembles
5. Run the `:patches:writePatches` task in order to generate and write the patches back to `./src`
6. Update the patches version in `build.gradle.kts` if necessary
7. Commit changes to git

Any changes made to `./src` after having run `:patches:disassembleWithPatches` will be discarded when generating patches!
